# 株式会社ハートビーツさんから出された課題「lamp環境の構築」の課程7
まさかapacheの設定に3日も掛けているとは。firewallで苦戦したのが懐かしくなってきた。
今思えばfirewallもVisualHostも知らないままWebサイトを作ろうとしていたとは、独学って怖いのかもしれない。

## Apacheの設定4

Apacheの英語ドキュメントを見返したら"NameVirtualHost"は廃止されているようだ。
だが、その前に2つ程確認せねばならぬことがある。

```
$ cat /etc/hosts
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateHosts = false
127.0.0.1       localhost
127.0.1.1       DESKTOP-F5G6OIO.        DESKTOP-F5G6OIO
<feff>
192.168.0.17    host.docker.internal
192.168.0.17    gateway.docker.internal
127.0.0.1       kubernetes.docker.internal

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters                                    
```

やっぱり、日付が変わる度に内容がもとに戻る。

```
$ sudo systemctl status apache2
● apache2.service - The Apache HTTP Server
     Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
     Active: active (running) since Mon 2023-08-21 09:52:08 JST; 4min 41s ago
       Docs: https://httpd.apache.org/docs/2.4/
    Process: 262 ExecStart=/usr/sbin/apachectl start (code=exited, status=0/SUCCESS)
   Main PID: 306 (apache2)
      Tasks: 55 (limit: 9371)
     Memory: 20.0M
     CGroup: /system.slice/apache2.service
             ├─306 /usr/sbin/apache2 -k start
             ├─307 /usr/sbin/apache2 -k start
             └─309 /usr/sbin/apache2 -k start

Aug 21 09:52:08 DESKTOP-F5G6OIO systemd[1]: Starting The Apache HTTP Server...
Aug 21 09:52:08 DESKTOP-F5G6OIO apachectl[285]: AH00548: NameVirtualHost has no effect and will be removed in the next >
Aug 21 09:52:08 DESKTOP-F5G6OIO apachectl[285]: AH00112: Warning: DocumentRoot [/www/familyname-hbtask.local] does not >
Aug 21 09:52:08 DESKTOP-F5G6OIO apachectl[285]: AH00112: Warning: DocumentRoot [/www/firstname-hbtask.local] does not e>
Aug 21 09:52:08 DESKTOP-F5G6OIO systemd[1]: Started The Apache HTTP Server.
```

apacheは動いている。

```
$ sudo vim /etc/apache2/sites-enabled/hbtask.conf
$ cat /etc/apache2/sites-enabled/hbtask.conf
<VirtualHost 102.54.94.97:80>
    DocumentRoot "/www/familyname-hbtask.local"
    ServerName familyname-hbtask.local
</VirtualHost>

<VirtualHost 102.54.94.97:80>
    DocumentRoot "/www/firstname-hbtask.local"
    ServerName firstname-hbtask.local
</VirtualHost>
```
中身はそのまま、"NameVirtualHost"廃止の情報を見かけたので、一行削除する。

```
$ sudo vim /etc/hosts
```

```
102.54.94.97    familyname-hbtask.local
102.54.94.97     firstname-hbtask.local
```

これらを追記。

```
$ sudo systemctl status apache2
```
警告が増えた。

```
DocumentRoot [/www/familyname-hbtask.local] does not exist
DocumentRoot [/www/firstname-hbtask.local] does not exist
```
なんだって？

```
$ cd /var/www
$ ls
familyname-hbtask.local  firstname-hbtask.local  html
```
なるほど、パスが間違っていた疑惑が浮上。

```
$ sudo vim /etc/apache2/sites-enabled/hbtask.conf
$ cat /etc/apache2/sites-enabled/hbtask.conf
<VirtualHost 102.54.94.97:80>
    DocumentRoot "/var/www/familyname-hbtask.local"
    ServerName familyname-hbtask.local
</VirtualHost>

<VirtualHost 102.54.94.97:80>
    DocumentRoot "/var/www/firstname-hbtask.local"
    ServerName firstname-hbtask.local
</VirtualHost>
```

```
$ sudo systemctl status apache2
```

まだ警告がでる。

```
NameVirtualHost has no effect and will be removed
```
NameVirtualHostの行、消したのに。

```
$ sudo systemctl restart apache2
$ sudo systemctl status apache2
● apache2.service - The Apache HTTP Server
     Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
     Active: active (running) since Mon 2023-08-21 10:22:23 JST; 4s ago
       Docs: https://httpd.apache.org/docs/2.4/
    Process: 1103 ExecStart=/usr/sbin/apachectl start (code=exited, status=0/SUCCESS)
   Main PID: 1107 (apache2)
      Tasks: 55 (limit: 9371)
     Memory: 17.0M
     CGroup: /system.slice/apache2.service
             ├─1107 /usr/sbin/apache2 -k start
             ├─1108 /usr/sbin/apache2 -k start
             └─1109 /usr/sbin/apache2 -k start

Aug 21 10:22:23 DESKTOP-F5G6OIO systemd[1]: Starting The Apache HTTP Server...
Aug 21 10:22:23 DESKTOP-F5G6OIO systemd[1]: Started The Apache HTTP Server.
```

再起動。警告が消えた。
接続できなかった。